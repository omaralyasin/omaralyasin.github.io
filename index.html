<!DOCTYPE html>
<!--
    Name: Omar Alyasin
    File: homework3.html
    Date created: 11/14/2025
    Date last edited: 11/14/2025
    Version: 3 
    Description: Patient Intake Form with Real-Time JavaScript Validation, Fetch API, iFrames, Cookies, and Local Storage
-->
<html>
<head>
<link rel="stylesheet" href="styles.css">
<style>
body {
    background-color: #D1A879;
    padding-top: 200px;
    padding-bottom: 120px;
    margin: 0;
    font-family: Arial, sans-serif;
}


.fixed-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background-color: #8B6F47;
    z-index: 1000;
    padding: 15px;
    border-bottom: 3px solid black;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

.fixed-header h1 {
    margin: 0;
    font-size: 40px;
    color: white;
}

.welcome-message {
    margin: 10px 0;
    color: white;
    font-size: 18px;
}

.new-user-option {
    margin-top: 10px;
}

.new-user-option label {
    color: white;
    cursor: pointer;
}


.fixed-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #8B6F47;
    z-index: 1000;
    padding: 15px;
    border-top: 3px solid black;
    text-align: center;
    color: white;
}

table, th, td {
    border: 3px solid black;
    border-collapse: collapse;
    background-color: #E5C29F;
}

th, td {
    padding: 20px;
    vertical-align: top;
}

.iframe-section {
    margin: 30px 0;
    padding: 20px;
    border: 3px solid black;
    background-color: #C19A6B;
}

.remember-me-section {
    margin: 20px 0;
    padding: 15px;
    background-color: #F5DEB3;
    border: 2px solid black;
    font-weight: bold;
}


.error-message {
    color: red;
    font-size: 12px;
    display: block;
    min-height: 18px;
    margin-top: 3px;
    font-weight: bold;
}

.success-message {
    color: green;
    font-size: 12px;
    display: block;
    min-height: 18px;
    margin-top: 3px;
}

.input-error {
    border: 2px solid red !important;
    background-color: #ffe6e6;
}

.input-success {
    border: 2px solid green !important;
    background-color: #e6ffe6;
}

input[type="text"], input[type="email"], input[type="tel"], 
input[type="password"], input[type="date"], select, textarea {
    padding: 8px;
    font-size: 14px;
}

.checkbox-group, .radio-group {
    margin: 10px 0;
}

.slider-container {
    margin: 15px 0;
}

.slider-value {
    font-weight: bold;
    color: #8B6F47;
    font-size: 18px;
}

button {
    padding: 12px 25px;
    font-size: 16px;
    cursor: pointer;
    margin: 5px;
}

#validateBtn {
    background-color: #4CAF50;
    color: white;
    border: 2px solid #3d8b40;
}

#submitBtn {
    background-color: #008CBA;
    color: white;
    border: 2px solid #007399;
    display: none;
}

#resetBtn {
    background-color: #f44336;
    color: white;
    border: 2px solid #da190b;
}

.form-section {
    margin: 20px 0;
    padding: 15px;
    background-color: #E5C29F;
    border: 2px solid black;
}
</style>
</head>
<body>


<div class="fixed-header">
    <h1>üè• Plague's Patient Form</h1>
    <div class="welcome-message" id="welcomeMsg">Welcome!</div>
    <div class="new-user-option" id="notUserSection" style="display:none;">
        <input type="checkbox" id="notUserCheckbox" onchange="startAsNewUser()">
        <label for="notUserCheckbox">Not <span id="cookieName"></span>? Click here to start as a NEW USER.</label>
    </div>
    <div style="color: white; font-size: 14px; margin-top: 5px;">
        <span id="currentDateTime"></span>
    </div>
</div>

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Paul_F%C3%BCrst%2C_Der_Doctor_Schnabel_von_Rom_%28coloured_version%29.png/250px-Paul_F%C3%BCrst%2C_Der_Doctor_Schnabel_von_Rom_%28coloured_version%29.png" alt="Plague Doctor" width="600" height="350" style="display: block; margin: 0 auto;">


<div class="iframe-section">
    <h2>üìã Medical Information Resources (iFrame Demo)</h2>
    <p>Select a resource to view:</p>
    <select id="iframeSelect" onchange="changeIframe()" style="padding: 10px; font-size: 16px; margin-bottom: 10px;">
        <option value="https://www.cdc.gov/">CDC - Centers for Disease Control</option>
        <option value="https://www.who.int/">WHO - World Health Organization</option>
        <option value="https://en.wikipedia.org/wiki/Plague_(disease)">Wikipedia - Plague Information</option>
        <option value="https://medlineplus.gov/">MedlinePlus - Health Information</option>
    </select>
    <iframe id="contentFrame" src="https://www.cdc.gov/" width="100%" height="450" style="border: 3px solid black;"></iframe>
</div>

<form id="patientForm" novalidate>

<div class="form-section">
<h2>Personal Information</h2>
<table style="width:100%">
  <tr>
    <td>
        <label for="fname">First Name: *</label><br>
        <input type="text" id="fname" name="fname" placeholder="Omar" maxlength="30"
               title="1-30 characters, letters only (apostrophes and dashes allowed)"
               oninput="validateFirstName()" onblur="saveFieldToLocalStorage('fname')">
        <span class="error-message" id="fname-error"></span>
    </td>
    <td>
        <label for="minit">Middle Initial:</label><br>
        <input type="text" id="minit" name="minit" placeholder="N" maxlength="1"
               title="Optional: One letter only"
               oninput="validateMiddleInitial()" onblur="saveFieldToLocalStorage('minit')">
        <span class="error-message" id="minit-error"></span>
    </td> 
    <td>
        <label for="lname">Last Name: *</label><br>
        <input type="text" id="lname" name="lname" placeholder="Alyasin" maxlength="30"
               title="1-30 characters, letters only (apostrophes and dashes allowed)"
               oninput="validateLastName()" onblur="saveFieldToLocalStorage('lname')">
        <span class="error-message" id="lname-error"></span>
    </td>
  </tr>
  <tr>
    <td colspan="3">
        <label for="dob">Date of Birth: * (MM/DD/YYYY)</label><br>
        <input type="text" id="dobMonth" placeholder="MM" maxlength="2" style="width: 60px;"
               title="Month (01-12)" oninput="validateDOB()"> /
        <input type="text" id="dobDay" placeholder="DD" maxlength="2" style="width: 60px;"
               title="Day (01-31)" oninput="validateDOB()"> /
        <input type="text" id="dobYear" placeholder="YYYY" maxlength="4" style="width: 80px;"
               title="Year (not future, not more than 120 years ago)" oninput="validateDOB()">
        <span class="error-message" id="dob-error"></span>
    </td>
  </tr>
</table>
</div>

<div class="form-section">
<h2>Account Information</h2>
<table style="width:100%">
  <tr>
    <td>
        <label for="userid">User ID: *</label><br>
        <input type="text" id="userid" name="userid" placeholder="john_doe123" maxlength="20"
               title="5-20 characters, cannot start with number, letters/numbers/dash/underscore only"
               oninput="validateUserID()" onblur="saveFieldToLocalStorage('userid')">
        <span class="error-message" id="userid-error"></span>
    </td>
    <td>
        <label for="pass">Password: *</label><br>
        <input type="password" id="pass" name="pass" maxlength="30"
               title="Min 8 chars, must have uppercase, lowercase, and digit"
               oninput="validatePassword()">
        <span class="error-message" id="pass-error"></span>
    </td>
    <td>
        <label for="pass2">Re-enter Password: *</label><br>
        <input type="password" id="pass2" name="pass2" maxlength="30"
               title="Must match password"
               oninput="validatePasswordMatch()">
        <span class="error-message" id="pass2-error"></span>
    </td>
  </tr>
  <tr>
    <td colspan="3">
        <label for="social">Social Security Number: *</label><br>
        <input type="password" id="social" name="social" placeholder="XXX-XX-XXXX" maxlength="11"
               title="9 digits (formatted as XXX-XX-XXXX automatically)"
               oninput="validateAndFormatSSN()">
        <span class="error-message" id="social-error"></span>
    </td>
  </tr>
</table>
</div>

<div class="form-section">
<h2>Contact Information</h2>
<table style="width:100%">
  <tr>
    <td>
        <label for="email">Email: *</label><br>
        <input type="email" id="email" name="email" placeholder="name@domain.com"
               title="Valid email format required"
               oninput="validateEmail()" onblur="saveFieldToLocalStorage('email')">
        <span class="error-message" id="email-error"></span>
    </td>
    <td>
        <label for="phone">Phone Number: *</label><br>
        <input type="tel" id="phone" name="phone" placeholder="(832) 970-0321"
               title="10 digits, formatted automatically"
               oninput="validateAndFormatPhone()" onblur="saveFieldToLocalStorage('phone')">
        <span class="error-message" id="phone-error"></span>
    </td>
  </tr>
</table>

<label for="address1">Address Line 1: *</label><br>
<input type="text" id="address1" name="address1" placeholder="123 Main St" maxlength="50" style="width: 500px;"
       title="2-50 characters required"
       oninput="validateAddress1()" onblur="saveFieldToLocalStorage('address1')">
<span class="error-message" id="address1-error"></span>

<br><br>
<label for="address2">Address Line 2:</label><br>
<input type="text" id="address2" name="address2" placeholder="Apt 4B" maxlength="50" style="width: 500px;"
       title="Optional: 2-50 characters if entered"
       oninput="validateAddress2()" onblur="saveFieldToLocalStorage('address2')">
<span class="error-message" id="address2-error"></span>

<br><br>
<table style="width:100%">
  <tr>
    <td>
        <label for="city">City: *</label><br>
        <input type="text" id="city" name="city" placeholder="Houston"
               title="2-30 characters, letters only"
               oninput="validateCity()" onblur="saveFieldToLocalStorage('city')">
        <span class="error-message" id="city-error"></span>
    </td>
    <td>
        <label for="state">State: *</label><br>
        <select id="state" name="state" onchange="validateState(); saveFieldToLocalStorage('state')"
                title="Please select a state">
            <option value="">Loading states...</option>
        </select>
        <span class="error-message" id="state-error"></span>
    </td>
    <td>
        <label for="zip">Zip Code: *</label><br>
        <input type="text" id="zip" name="zip" placeholder="77001" maxlength="5"
               title="5 digits required"
               oninput="validateZip()" onblur="saveFieldToLocalStorage('zip')">
        <span class="error-message" id="zip-error"></span>
    </td>
  </tr>
</table>
</div>

<div class="form-section">
<h2>Additional Information</h2>

<label>Gender: *</label><br>
<div class="radio-group">
    <input type="radio" id="male" name="gender" value="male" onchange="validateGender(); saveFieldToLocalStorage('gender')">
    <label for="male">Male</label>
    <input type="radio" id="female" name="gender" value="female" onchange="validateGender(); saveFieldToLocalStorage('gender')">
    <label for="female">Female</label>
    <input type="radio" id="other" name="gender" value="other" onchange="validateGender(); saveFieldToLocalStorage('gender')">
    <label for="other">Other</label>
</div>
<span class="error-message" id="gender-error"></span>

<br>
<label>Marital Status: *</label><br>
<div class="radio-group">
    <input type="radio" id="single" name="marital_status" value="single" onchange="validateMaritalStatus(); saveFieldToLocalStorage('marital_status')">
    <label for="single">Single</label>
    <input type="radio" id="married" name="marital_status" value="married" onchange="validateMaritalStatus(); saveFieldToLocalStorage('marital_status')">
    <label for="married">Married</label>
    <input type="radio" id="divorced" name="marital_status" value="divorced" onchange="validateMaritalStatus(); saveFieldToLocalStorage('marital_status')">
    <label for="divorced">Divorced</label>
</div>
<span class="error-message" id="marital_status-error"></span>

<br>
<label>Do you have health insurance? *</label><br>
<div class="radio-group">
    <input type="radio" id="insure_yes" name="insure" value="YES" onchange="validateInsurance(); saveFieldToLocalStorage('insure')">
    <label for="insure_yes">YES</label>
    <input type="radio" id="insure_no" name="insure" value="NO" onchange="validateInsurance(); saveFieldToLocalStorage('insure')">
    <label for="insure_no">NO</label>
</div>
<span class="error-message" id="insure-error"></span>

<br>
<label for="payment">Payment Method: *</label><br>
<select id="payment" name="payment" onchange="validatePayment(); saveFieldToLocalStorage('payment')"
        title="Please select a payment method">
    <option value="">Select payment method</option>
    <option value="visa">Visa</option>
    <option value="mastercard">MasterCard</option>
    <option value="insurance">Insurance</option>
    <option value="cash">Cash</option>
</select>
<span class="error-message" id="payment-error"></span>

<br><br>
<label>Check all medical conditions that apply: * (Select at least one)</label>
<div class="checkbox-group">
    <input type="checkbox" id="condition1" name="conditions" value="chickenpox" onchange="validateConditions()">
    <label for="condition1">Chicken Pox</label><br>
    <input type="checkbox" id="condition2" name="conditions" value="measles" onchange="validateConditions()">
    <label for="condition2">Measles</label><br>
    <input type="checkbox" id="condition3" name="conditions" value="covid19" onchange="validateConditions()">
    <label for="condition3">COVID-19</label><br>
    <input type="checkbox" id="condition4" name="conditions" value="flu" onchange="validateConditions()">
    <label for="condition4">Influenza</label><br>
    <input type="checkbox" id="condition5" name="conditions" value="mumps" onchange="validateConditions()">
    <label for="condition5">Mumps</label><br>
    <input type="checkbox" id="condition6" name="conditions" value="none" onchange="validateConditions()">
    <label for="condition6">None of the Above</label>
</div>
<span class="error-message" id="conditions-error"></span>

<br>
<div class="slider-container">
    <label for="salary">Desired Annual Salary: * </label>
    <span class="slider-value" id="salaryValue">$110,000</span><br>
    <input type="range" id="salary" name="salary" min="20000" max="200000" value="110000" step="5000"
           style="width: 400px;"
           title="Select your desired salary range"
           oninput="updateSalaryDisplay(); validateSalary(); saveFieldToLocalStorage('salary')">
    <br>$20,000 ‚Üê‚Üí $200,000
</div>
<span class="error-message" id="salary-error"></span>

<br>
<label for="comment">Additional Comments:</label><br>
<textarea rows="5" cols="70" name="comment" id="comment" maxlength="500" 
          placeholder="Enter any additional information here..."
          title="Optional: Any additional comments (max 500 characters)"
          oninput="validateComments()" onblur="saveFieldToLocalStorage('comment')"></textarea>
<span class="error-message" id="comment-error"></span>
</div>


<div class="remember-me-section">
    <input type="checkbox" id="rememberMe" checked onchange="handleRememberMe()">
    <label for="rememberMe">Remember Me (Save my information for next visit)</label>
    <p style="font-size: 12px; margin: 5px 0 0 0; font-weight: normal;">
        Uncheck this box if you don't want your information saved. Your data will be cleared.
    </p>
</div>

<div style="margin: 20px 0; text-align: center;">
    <button type="button" id="validateBtn" onclick="validateAllFields()">Validate Form</button>
    <button type="button" id="submitBtn" onclick="submitForm()" style="display:none;">Submit Form</button>
    <button type="button" id="resetBtn" onclick="resetForm()">Clear Form</button>
</div>

<div id="validationSummary" style="margin: 20px 0; padding: 15px; background-color: #fff3cd; border: 2px solid #ffc107; display: none;">
    <h3>‚ö†Ô∏è Please fix the following errors:</h3>
    <ul id="errorList"></ul>
</div>

</form>


<div class="fixed-footer">
    <p style="margin: 5px 0;"><strong>Plague's Medical Center</strong> | Est. 1347</p>
    <p style="margin: 5px 0; font-size: 12px;">
        ¬© 2025 | Contact: (555) 123-4567 | emergency@plague-center.com
    </p>
    <p style="margin: 5px 0; font-size: 11px;">
        Today's Date: <span id="footerDate"></span>
    </p>
</div>

<script src="validation.js"></script>
<script>

let rememberMeChecked = true;
let errorCount = 0;

window.onload = async function() {
    updateDateTime();
    setInterval(updateDateTime, 1000);
    
    await loadStatesFromJSON();
    checkExistingUser();
    updateSalaryDisplay();
};

function updateDateTime() {
    const now = new Date();
    document.getElementById("currentDateTime").textContent = now.toLocaleString();
    document.getElementById("footerDate").textContent = now.toLocaleDateString();
}



function validateFirstName() {
    const field = document.getElementById('fname');
    const error = document.getElementById('fname-error');
    const value = field.value.trim();
    
    if (value === '') {
        showError(field, error, 'First name is required');
        return false;
    }
    
    if (value.length < 1 || value.length > 30) {
        showError(field, error, 'First name must be 1-30 characters');
        return false;
    }
    
    if (!/^[A-Za-z\-' ]+$/.test(value)) {
        showError(field, error, 'Only letters, apostrophes, and dashes allowed');
        return false;
    }
    
    showSuccess(field, error);
    return true;
}

function validateMiddleInitial() {
    const field = document.getElementById('minit');
    const error = document.getElementById('minit-error');
    const value = field.value.trim();
    
    if (value === '') {
        clearValidation(field, error);
        return true;
    }
    
    if (!/^[A-Za-z]$/.test(value)) {
        showError(field, error, 'Must be a single letter');
        return false;
    }
    
    showSuccess(field, error);
    return true;
}

function validateLastName() {
    const field = document.getElementById('lname');
    const error = document.getElementById('lname-error');
    const value = field.value.trim();
    
    if (value === '') {
        showError(field, error, 'Last name is required');
        return false;
    }
    
    if (value.length < 1 || value.length > 30) {
        showError(field, error, 'Last name must be 1-30 characters');
        return false;
    }
    
    if (!/^[A-Za-z\-' ]+$/.test(value)) {
        showError(field, error, 'Only letters, apostrophes, and dashes allowed');
        return false;
    }
    
    showSuccess(field, error);
    return true;
}

function validateDOB() {
    const month = document.getElementById('dobMonth').value;
    const day = document.getElementById('dobDay').value;
    const year = document.getElementById('dobYear').value;
    const error = document.getElementById('dob-error');
    
    if (!month || !day || !year) {
        error.textContent = 'Date of birth is required (MM/DD/YYYY)';
        error.className = 'error-message';
        return false;
    }
    
    const monthNum = parseInt(month);
    const dayNum = parseInt(day);
    const yearNum = parseInt(year);
    
    if (isNaN(monthNum) || monthNum < 1 || monthNum > 12) {
        error.textContent = 'Month must be between 01-12';
        error.className = 'error-message';
        return false;
    }
    
    if (isNaN(dayNum) || dayNum < 1 || dayNum > 31) {
        error.textContent = 'Day must be between 01-31';
        error.className = 'error-message';
        return false;
    }
    
    if (isNaN(yearNum) || yearNum < 1900 || yearNum.toString().length !== 4) {
        error.textContent = 'Year must be 4 digits';
        error.className = 'error-message';
        return false;
    }
    
    const dob = new Date(yearNum, monthNum - 1, dayNum);
    const today = new Date();
    const age = today.getFullYear() - dob.getFullYear();
    
    if (dob > today) {
        error.textContent = 'Date cannot be in the future';
        error.className = 'error-message';
        return false;
    }
    
    if (age > 120) {
        error.textContent = 'Date cannot be more than 120 years ago';
        error.className = 'error-message';
        return false;
    }
    
    if (dob.getMonth() !== monthNum - 1 || dob.getDate() !== dayNum) {
        error.textContent = 'Invalid date';
        error.className = 'error-message';
        return false;
    }
    
    error.textContent = '‚úì Valid';
    error.className = 'success-message';
    return true;
}

function validateUserID() {
    const field = document.getElementById('userid');
    const error = document.getElementById('userid-error');
    const value = field.value.trim();
    
    if (value === '') {
        showError(field, error, 'User ID is required');
        return false;
    }
    
    if (/^\d/.test(value)) {
        showError(field, error, 'User ID cannot start with a number');
        return false;
    }
    
    if (value.length < 5 || value.length > 20) {
        showError(field, error, 'User ID must be 5-20 characters');
        return false;
    }
    
    if (!/^[A-Za-z0-9_-]+$/.test(value)) {
        showError(field, error, 'Only letters, numbers, dash, and underscore allowed');
        return false;
    }
    
    showSuccess(field, error);
    return true;
}

function validatePassword() {
    const field = document.getElementById('pass');
    const error = document.getElementById('pass-error');
    const value = field.value;
    const userid = document.getElementById('userid').value;
    
    if (value === '') {
        showError(field, error, 'Password is required');
        return false;
    }
    
    if (value.length < 8) {
        showError(field, error, 'Password must be at least 8 characters');
        return false;
    }
    
    if (!/[A-Z]/.test(value)) {
        showError(field, error, 'Password must contain at least one uppercase letter');
        return false;
    }
    
    if (!/[a-z]/.test(value)) {
        showError(field, error, 'Password must contain at least one lowercase letter');
        return false;
    }
    
    if (!/\d/.test(value)) {
        showError(field, error, 'Password must contain at least one digit');
        return false;
    }
    
    if (value === userid) {
        showError(field, error, 'Password cannot be the same as User ID');
        return false;
    }
    
    showSuccess(field, error);
    validatePasswordMatch();
    return true;
}

function validatePasswordMatch() {
    const pass1 = document.getElementById('pass').value;
    const pass2 = document.getElementById('pass2');
    const error = document.getElementById('pass2-error');
    const value = pass2.value;
    
    if (value === '') {
        showError(pass2, error, 'Please re-enter password');
        return false;
    }
    
    if (value !== pass1) {
        showError(pass2, error, 'Passwords do not match');
        return false;
    }
    
    showSuccess(pass2, error);
    return true;
}

function validateAndFormatSSN() {
    const field = document.getElementById('social');
    const error = document.getElementById('social-error');
    let value = field.value.replace(/\D/g, '');
    
    if (value.length > 9) {
        value = value.substring(0, 9);
    }
    
    if (value.length >= 6) {
        value = value.substring(0, 3) + '-' + value.substring(3, 5) + '-' + value.substring(5);
    } else if (value.length >= 4) {
        value = value.substring(0, 3) + '-' + value.substring(3);
    }
    
    field.value = value;
    
    const digitsOnly = value.replace(/\D/g, '');
    
    if (digitsOnly === '') {
        showError(field, error, 'SSN is required');
        return false;
    }
    
    if (digitsOnly.length !== 9) {
        showError(field, error, 'SSN must be 9 digits');
        return false;
    }
    
    showSuccess(field, error);
    return true;
}

function validateEmail() {
    const field = document.getElementById('email');
    const error = document.getElementById('email-error');
    let value = field.value.trim().toLowerCase();
    field.value = value;
    
    if (value === '') {
        showError(field, error, 'Email is required');
        return false;
    }
    
    const emailRegex = /^[a-z0-9._-]+@[a-z0-9.-]+\.[a-z]{2,}$/;
    
    if (!emailRegex.test(value)) {
        showError(field, error, 'Invalid email format (name@domain.tld)');
        return false;
    }
    
    showSuccess(field, error);
    return true;
}

function validateAndFormat
