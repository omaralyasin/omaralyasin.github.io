<!DOCTYPE html>
<!--
    Name: Omar Alyasin
    File: homework4.html
    Date created: 12/6/2025
    Date last edited: 12/10/2025
    Version: 2 
    Description: Homework4 Creating Patient Intake Form with Fetch API, iFrames, Content Protection, Cookies, and Local Storage
-->
<html>
<head>
<style>
body {
    background-color: #D1A879;
    padding-top: 150px; 
}


.fixed-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background-color: #8B6F47;
    z-index: 1000;
    padding: 10px;
    border-bottom: 3px solid black;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

.fixed-header h1 {
    margin: 0;
    font-size: 40px;
    color: white;
}

.fixed-header .date-time {
    margin: 5px 0;
    color: white;
}

table, th, td {
    border: 3px solid black;
    border-collapse: collapse;
}
th, td {
    padding: 20px;
}

.iframe-container {
    margin: 20px 0;
    border: 3px solid black;
    padding: 10px;
    background-color: #C19A6B;
}

.api-data {
    margin: 20px 0;
    padding: 15px;
    border: 3px solid black;
    background-color: #E5C29F;
}

.storage-info {
    margin: 20px 0;
    padding: 15px;
    border: 3px solid black;
    background-color: #F5DEB3;
}

.cookie-notice {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #333;
    color: white;
    padding: 15px;
    text-align: center;
    z-index: 999;
    display: none;
}

.cookie-notice button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 10px 20px;
    margin-left: 10px;
    cursor: pointer;
}
</style>
</head>
<body>


<div class="fixed-header">
    <h1>Plague's Patient Form</h1>
    <div class="date-time" id="headerDate"></div>
    <div style="color: white; font-size: 14px;">Welcome back, <span id="lastUser">Guest</span>!</div>
</div>


<div class="cookie-notice" id="cookieNotice">
    <p>This website uses cookies to save your preferences and form data. Do you accept?</p>
    <button onclick="acceptCookies()">Accept</button>
    <button onclick="declineCookies()">Decline</button>
</div>

<h2><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Paul_F%C3%BCrst%2C_Der_Doctor_Schnabel_von_Rom_%28coloured_version%29.png/250px-Paul_F%C3%BCrst%2C_Der_Doctor_Schnabel_von_Rom_%28coloured_version%29.png" alt="Plague Doctor" width="600" height="350"></h2>


<div class="storage-info">
    <h3>üì¶ Local Storage Info</h3>
    <p>Previous form submissions: <span id="submissionCount">0</span></p>
    <p>Last saved: <span id="lastSaved">Never</span></p>
    <button onclick="clearLocalStorage()">Clear Saved Data</button>
    <button onclick="loadSavedData()">Load Last Entry</button>
</div>


<div class="api-data">
    <h3>üåê Fetch API Demo - Random Patient Data</h3>
    <button onclick="fetchRandomUser()">Fetch Random Patient</button>
    <div id="apiResult"></div>
</div>


<div class="iframe-container">
    <h3>üìã iFrame - Embedded Health Information</h3>
    <label for="iframeSelect">Choose content to display:</label>
    <select id="iframeSelect" onchange="changeIframe()">
        <option value="https://www.cdc.gov/">CDC Website</option>
        <option value="https://www.who.int/">WHO Website</option>
        <option value="https://en.wikipedia.org/wiki/Plague_(disease)">Wikipedia - Plague</option>
    </select>
    <br><br>
    <iframe id="contentFrame" src="https://www.cdc.gov/" width="100%" height="400" style="border: 2px solid black;"></iframe>
</div>

<form action="results.html" method="GET" id="patientForm">

<table style="width:100%">
  <tr>
    <td><label for="fname">First Name:</label>
            <input type="text" id="fname" name="fname" placeholder="Omar" maxlength="30" pattern="[A-Za-z\-' ]{2,}"
                    required
                    oninvalid="this.setCustomValidity('First Name is Required')"
                    oninput="this.setCustomValidity(''); saveToLocalStorage()"> </td>
    <td><label for="minit">Middle Initial:</label>
            <input type="text" id="minit" name="minit" placeholder="N" maxlength="1" pattern="[A-Za-z]"
                    oninvalid="this.setCustomValidity('Letters only please.')"
                    oninput="this.setCustomValidity(''); saveToLocalStorage()" ></td> 
    <td><label for="lname">Last Name:</label>
            <input type="text" id="lname" name="lname" placeholder="Alyasin" maxlength="30" pattern="[A-Za-z\-' ]{2,}"
                    required
                    oninvalid="this.setCustomValidity('Last Name is Required')"
                    oninput="this.setCustomValidity(''); saveToLocalStorage()"></td>
  </tr>
  <tr>
    <td><label for="user">Username:</label>
            <input type="text" id="user" name="user" placeholder="Epicdragon91" maxlength="20" minlength="5" required
                   oninput="saveToLocalStorage()"></td>
    <td><label for="pass">Password:</label>
            <input type="password" id="pass" name="pass" maxlength="12" required>
            <label for="pass2">Re-enter Password:</label>
            <input type="password" id="pass2" name="pass2" maxlength="12" required></td>
    <td><label for="social">Social Security Number:</label>
            <input type="password" id="social" name="social" maxlength="9" required></td>
  </tr>
  <tr>
    <td><label for="email">Email:</label>
            <input type="email" id="email" name="email" placeholder="name@domain.tld" oninput="saveToLocalStorage()"></td>
    <td><label for="phone">Phone Number:</label>
            <input type="tel" id="phone" name="phone" placeholder="(832)-970-0321" oninput="saveToLocalStorage()"></td>
    <td><label for="bdate">Birthdate:</label>
            <input type="date" id="bdate" name="bdate" oninput="saveToLocalStorage()"></td>
  </tr>
  <tr>
    <td><label for="gender">Legal Gender:</label> 
            <label for="male">Male</label>
            <input type="radio" id="male" name="gender" value="male" onchange="saveToLocalStorage()">
            <label for="female">Female</label>
            <input type="radio" id="female" name="gender" value="female" onchange="saveToLocalStorage()"></td>
    <td><label for="Mstatus">Marital Status:</label>
            <label for="single">Single</label>
            <input type="radio" id="single" name="Marital_Status" value="single" onchange="saveToLocalStorage()">
            <label for="married">Married</label>
            <input type="radio" id="married" name="Marital_Status" value="married" onchange="saveToLocalStorage()"></td>
    <td><label for="insure">Insurance:</label> 
            <label for="insure_yes">YES</label>
            <input type="radio" id="insure_yes" name="insure" value="YES" onchange="saveToLocalStorage()">
            <label for="insure_no">NO</label>
            <input type="radio" id="insure_no" name="insure" value="NO" onchange="saveToLocalStorage()"></td>
  </tr>
</table>

<p><label for="payment">Payment:</label>
    <select id="payment" name="payment" onchange="saveToLocalStorage()">
        <option value="visa">Visa</option>
        <option value="mastercard">MasterCard</option>
        <option value="insurance">Insurance</option>
    </select>
</p>

<div>
    <label for="state">State:</label>
    <select id="state" name="state" required onchange="saveToLocalStorage()">
        <option value="">Select a state</option>
        <option value="AL">Alabama</option>
        <option value="AK">Alaska</option>
        <option value="AZ">Arizona</option>
        <option value="AR">Arkansas</option>
        <option value="CA">California</option>
        <option value="CO">Colorado</option>
        <option value="CT">Connecticut</option>
        <option value="DE">Delaware</option>
        <option value="DC">District Of Columbia</option>
        <option value="FL">Florida</option>
        <option value="GA">Georgia</option>
        <option value="HI">Hawaii</option>
        <option value="ID">Idaho</option>
        <option value="IL">Illinois</option>
        <option value="IN">Indiana</option>
        <option value="IA">Iowa</option>
        <option value="KS">Kansas</option>
        <option value="KY">Kentucky</option>
        <option value="LA">Louisiana</option>
        <option value="ME">Maine</option>
        <option value="MD">Maryland</option>
        <option value="MA">Massachusetts</option>
        <option value="MI">Michigan</option>
        <option value="MN">Minnesota</option>
        <option value="MS">Mississippi</option>
        <option value="MO">Missouri</option>
        <option value="MT">Montana</option>
        <option value="NE">Nebraska</option>
        <option value="NV">Nevada</option>
        <option value="NH">New Hampshire</option>
        <option value="NJ">New Jersey</option>
        <option value="NM">New Mexico</option>
        <option value="NY">New York</option>
        <option value="NC">North Carolina</option>
        <option value="ND">North Dakota</option>
        <option value="OH">Ohio</option>
        <option value="OK">Oklahoma</option>
        <option value="OR">Oregon</option>
        <option value="PA">Pennsylvania</option>
        <option value="RI">Rhode Island</option>
        <option value="SC">South Carolina</option>
        <option value="SD">South Dakota</option>
        <option value="TN">Tennessee</option>
        <option value="TX">Texas</option>
        <option value="UT">Utah</option>
        <option value="VT">Vermont</option>
        <option value="VA">Virginia</option>
        <option value="WA">Washington</option>
        <option value="WV">West Virginia</option>
        <option value="WI">Wisconsin</option>
        <option value="WY">Wyoming</option>
    </select>
</div>

<br>
<label for="slider">Was this useful:</label>
1<input type="range" id="slider" name="slider" step="25" value="100" min="0" max="100" onchange="saveToLocalStorage()">5
<br>

<div>
    <textarea rows="5" cols="50" name="comment" id="comment" maxlength="110" placeholder="Comments/Questions..." oninput="saveToLocalStorage()"></textarea>
</div>

<p><label for="address">Address:</label>
<input type="text" id="address" name="address" maxlength="30" required oninput="saveToLocalStorage()"></p>

<p><label for="zip">Zip Code:</label>
<input type="text" id="zip" name="zip" maxlength="5" pattern="[0-9]{5}" required oninput="saveToLocalStorage()"></p>

<p><label for="city">City:</label>
<input type="text" id="city" name="city" placeholder="Houston" required oninput="saveToLocalStorage()"></p>

<div>
    <input type="reset" onclick="clearForm()"> 
    <input type="submit">
</div>

<br>
<p>Today's date: <span id="today"></span></p>

</form>

<script>

window.onload = function() {
    updateDateTime();
    setInterval(updateDateTime, 1000);
    checkCookieConsent();
    updateLocalStorageDisplay();
    loadLastUsername();
};

function updateDateTime() {
    const now = new Date();
    document.getElementById("headerDate").innerHTML = now.toLocaleString();
    document.getElementById("today").innerHTML = now.toLocaleDateString();
}


function checkCookieConsent() {
    const consent = getCookie("cookieConsent");
    if (!consent) {
        document.getElementById("cookieNotice").style.display = "block";
    }
}

function acceptCookies() {
    setCookie("cookieConsent", "accepted", 365);
    setCookie("lastVisit", new Date().toLocaleString(), 365);
    document.getElementById("cookieNotice").style.display = "none";
    alert("Cookies accepted! Your preferences will be saved.");
}

function declineCookies() {
    setCookie("cookieConsent", "declined", 365);
    document.getElementById("cookieNotice").style.display = "none";
    alert("Cookies declined. Some features may be limited.");
}

function setCookie(name, value, days) {
    const d = new Date();
    d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
    const expires = "expires=" + d.toUTCString();
    document.cookie = name + "=" + value + ";" + expires + ";path=/";
}

function getCookie(name) {
    const nameEQ = name + "=";
    const ca = document.cookie.split(';');
    for(let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
}


function saveToLocalStorage() {
    const formData = {
        fname: document.getElementById("fname").value,
        minit: document.getElementById("minit").value,
        lname: document.getElementById("lname").value,
        user: document.getElementById("user").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        bdate: document.getElementById("bdate").value,
        gender: document.querySelector('input[name="gender"]:checked')?.value || "",
        maritalStatus: document.querySelector('input[name="Marital_Status"]:checked')?.value || "",
        insurance: document.querySelector('input[name="insure"]:checked')?.value || "",
        payment: document.getElementById("payment").value,
        state: document.getElementById("state").value,
        slider: document.getElementById("slider").value,
        comment: document.getElementById("comment").value,
        address: document.getElementById("address").value,
        zip: document.getElementById("zip").value,
        city: document.getElementById("city").value,
        savedTime: new Date().toLocaleString()
    };
    
    try {
        localStorage.setItem("patientFormData", JSON.stringify(formData));
        document.getElementById("lastSaved").textContent = formData.savedTime;
    } catch(e) {
        console.error("Error saving to localStorage:", e);
    }
}

function loadSavedData() {
    try {
        const savedData = localStorage.getItem("patientFormData");
        if (savedData) {
            const formData = JSON.parse(savedData);
            document.getElementById("fname").value = formData.fname || "";
            document.getElementById("minit").value = formData.minit || "";
            document.getElementById("lname").value = formData.lname || "";
            document.getElementById("user").value = formData.user || "";
            document.getElementById("email").value = formData.email || "";
            document.getElementById("phone").value = formData.phone || "";
            document.getElementById("bdate").value = formData.bdate || "";
            document.getElementById("payment").value = formData.payment || "visa";
            document.getElementById("state").value = formData.state || "";
            document.getElementById("slider").value = formData.slider || "100";
            document.getElementById("comment").value = formData.comment || "";
            document.getElementById("address").value = formData.address || "";
            document.getElementById("zip").value = formData.zip || "";
            document.getElementById("city").value = formData.city || "";
            
            if (formData.gender) {
                document.getElementById(formData.gender).checked = true;
            }
            if (formData.maritalStatus) {
                document.getElementById(formData.maritalStatus).checked = true;
            }
            if (formData.insurance) {
                document.getElementById("insure_" + formData.insurance.toLowerCase()).checked = true;
            }
            
            alert("Previous form data loaded successfully!");
        } else {
            alert("No saved data found.");
        }
    } catch(e) {
        console.error("Error loading from localStorage:", e);
        alert("Error loading saved data.");
    }
}

function clearLocalStorage() {
    if (confirm("Are you sure you want to clear all saved data?")) {
        localStorage.removeItem("patientFormData");
        localStorage.removeItem("submissionCount");
        updateLocalStorageDisplay();
        alert("Saved data cleared!");
    }
}

function updateLocalStorageDisplay() {
    const count = localStorage.getItem("submissionCount") || 0;
    document.getElementById("submissionCount").textContent = count;
    
    const savedData = localStorage.getItem("patientFormData");
    if (savedData) {
        const formData = JSON.parse(savedData);
        document.getElementById("lastSaved").textContent = formData.savedTime || "Never";
    }
}

function loadLastUsername() {
    try {
        const savedData = localStorage.getItem("patientFormData");
        if (savedData) {
            const formData = JSON.parse(savedData);
            if (formData.fname) {
                document.getElementById("lastUser").textContent = formData.fname;
            }
        }
    } catch(e) {
        console.error("Error loading username:", e);
    }
}

function clearForm() {
    if (confirm("Are you sure you want to reset the form?")) {
        document.getElementById("patientForm").reset();
    }
}


async function fetchRandomUser() {
    const resultDiv = document.getElementById("apiResult");
    resultDiv.innerHTML = "<p>Loading random patient data...</p>";
    
    try {
        const response = await fetch('https://randomuser.me/api/');
        
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        
        const data = await response.json();
        const user = data.results[0];
        
        resultDiv.innerHTML = `
            <h4>Random Patient Information:</h4>
            <img src="${user.picture.large}" alt="Patient Photo" style="border-radius: 50%;">
            <p><strong>Name:</strong> ${user.name.first} ${user.name.last}</p>
            <p><strong>Email:</strong> ${user.email}</p>
            <p><strong>Phone:</strong> ${user.phone}</p>
            <p><strong>Location:</strong> ${user.location.city}, ${user.location.state}</p>
            <p><strong>DOB:</strong> ${new Date(user.dob.date).toLocaleDateString()}</p>
            <p><em>Note: This is sample data from RandomUser API for demonstration purposes.</em></p>
        `;
    } catch (error) {
        resultDiv.innerHTML = `<p style="color: red;">Error fetching data: ${error.message}</p>`;
        console.error('Fetch error:', error);
    }
}


function changeIframe() {
    const select = document.getElementById("iframeSelect");
    const iframe = document.getElementById("contentFrame");
    iframe.src = select.value;
}


document.getElementById("patientForm").addEventListener("submit", function(event) {
    event.preventDefault();
    
    
    let count = parseInt(localStorage.getItem("submissionCount") || "0");
    count++;
    localStorage.setItem("submissionCount", count.toString());
    
    
    const username = document.getElementById("fname").value;
    setCookie("lastUsername", username, 30);
    
    document.body.innerHTML = "<h1>Thank you for submitting your form!</h1><h2>We have received your information, " 
        + username + ".</h2><p>This is submission #" + count + "</p>";
});
</script>

</body>
</html>
